{% extends 'layout-2-1-bleedbar.html' %}

{% if not page %}
    {% do global_dict.update({
            'page':  {
                'seo_title':     'Sublanding Page - This is a prototype page for testing page layouts.',
                'related_posts': global_dict.related_posts_function
            },
            'related_posts_settings': {
                'value': {
                    'limit':            3,
                    'show_heading':     true,
                    'related_posts':    false,
                    'related_newsroom': false,
                    'related_events':   false,
                }
            },
            'prototype': true
        })
    %}
    {% set page = page or global_dict.page %}
    {% set prototype = global_dict.prototype or false %}
{% endif %}

{% import 'molecules/related-posts.html' as related_posts with context %}
{% import 'organisms/post-preview.html' as post_preview with context %}
{% import 'organisms/main-contact-info.html' as main_contact_info %}

{% block title -%}
    {{ page.seo_title }}
{%- endblock %}

{# TODO: Remove lipsumText when and if it is no longer needed. #}
{% set lipsumText = lipsum(1, false, 10, 25) | safe %}

{% block hero -%}
    {% for block in page.header -%}
        {% if 'hero' in block.block_type -%}
            {{ render_stream_child(block) }}
        {%- endif %}
    {%- endfor %}
{% endblock %}

{% block pre_content %}
    {% if page.sidebar_breakout %}
        {% include 'organisms/sidebar-breakout.html' %}
    {% endif %}
{% endblock %}

{% block content_main %}
    {% if prototype %}
        {% if not page.sidebar_breakout %}
            <div class="block">
                {% include 'molecules/text-introduction.html' %}
            </div>
        {% endif %}

        <div class="block">
            {% include 'molecules/featured-content.html' %}
        </div>
        <div class="block">
            {% include 'organisms/image-text-50-50-group.html' %}
        </div>
        <div class="block">
            {% include 'organisms/image-text-25-75-group.html' %}
        </div>
        <div class="block">
            {{ post_preview.render({
                'heading': 'This is a notice & comment post',
                'body': {
                    'source': lipsumText
                },
                'published_date': '20030805T213611',
                'post_category': ['Notice of request for public comment'],
                'external_link': 'Submit a comment',
                'external_link_url': 'http://www.google.com/',
                'comments_close_date': '20030805T213611'
                },
                '') }}
        </div>
        <div class="block">
            {% include 'organisms/well.html' %}
        </div>
        <div class="block">
            {% include 'organisms/half-width-link-blob-group.html' %}
        </div>
        <div class="block">
            {% include 'organisms/full-width-text.html' with context %}
        </div>
        <div class="block">
            {{ main_contact_info.render({
                    'heading': 'Header for text below',
                    'body':    lipsumText
                }, {
                    'emails':  ['test@example.com'],
                    'phones':  [{'number': '1234567899',
                                 'vanity': '123456AAAA',
                                 'tty':    '1234567899'}],
                    'faxes':   [{'number': '1234567899'}],
                    'address': {
                        'title':    'Consumer Financial Protection Bureau',
                        'street':   '1700 G Street, NW',
                        'city':     'Washington',
                        'state':    'DC',
                        'zip_code': '20552-0003'
                    }
                })
            }}
        </div>
    {% else %}
        {% for block in page.content -%}
            {% if loop.index == 1 %}
                <div class="block
                            block__flush-top">
            {% else %}
                <div class="block">
            {% endif %}
            {% if 'post_preview_snapshot' in block.block_type %}
                {% set posts = page.get_browsefilterable_posts(request) %}
                {% set limit = block.value.limit | int %}
                {% set num_posts = limit if limit <= posts | length else posts | length %}
                {% for i in range(num_posts) %}
                    {{ post_preview.render(posts[i], '', 0, pageurl(posts[i].parent())) }}
                {% endfor %}
            {% else %}
                {{ render_stream_child(block) }}
            {% endif %}
                </div>
        {%- endfor %}
    {% endif %}
{% endblock %}

{% block content_sidebar_modifiers -%}
    o-sidebar-content
{%- endblock %}

{% block content_sidebar scoped -%}
    {% if prototype %}
        {{ related_posts.render(global_dict.related_posts_settings) }}
        {% include 'organisms/email-signup.html' %}
    {% else %}
        {% for block in page.sidefoot %}
            {% if 'related_posts' in block.block_type %}
                {% import 'molecules/related-posts.html' as related_posts with context %}
                {{ related_posts.render(block) }}
            {% elif 'email_signup' in block.block_type %}
                {{ render_stream_child(block) }}
            {% else %}
                {% if 'heading' in block.block_type %}
                    <h3 class="o-sidebar-breakout_heading">
                        {{ render_stream_child(block) }}
                    </h3>
                {% elif 'slug' in block.block_type %}
                    <h2 class="header-slug">
                            <span class="header-slug_inner">
                                {{ render_stream_child(block) }}
                            </span>
                    </h2>
                {% elif 'paragraph' in block.block_type %}
                    {{ render_stream_child(block) }}
                {% else %}
                    {{ render_stream_child(block) }}
                {% endif %}
            {% endif %}
        {%- endfor %}
    {% endif %}
{%- endblock %}
